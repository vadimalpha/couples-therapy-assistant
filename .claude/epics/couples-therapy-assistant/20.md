---
name: Testing, Deployment & Launch
status: closed
created: 2025-12-23T20:56:49Z
updated: 2025-12-25T19:12:45Z
github: https://github.com/vadimalpha/taskmanager/issues/20
depends_on: [13, 14, 15, 16, 17, 18, 19]
parallel: false
conflicts_with: []
---

# Task: Testing, Deployment & Launch

## Description

Write comprehensive E2E tests for key workflows using Playwright, conduct security audit/penetration testing, deploy frontend to Vercel and backend to Railway, set up monitoring, and launch to first 50 couples for beta testing. Iterate based on feedback.

## Acceptance Criteria

- [ ] E2E tests (Playwright) cover:
  - User registration → intake survey → conflict creation → response → view guidance
  - Partner A creates conflict (private), Partner B responds, verifies description hidden
  - Partner A creates conflict (shared), Partner B responds, verifies description revealed
  - Structured mode vs Conversational mode guidance display
  - Pattern recognition appears after 3+ similar conflicts
- [ ] Security audit completed:
  - Penetration testing (OWASP Top 10)
  - Dependency vulnerability scan (`npm audit`)
  - Secrets scanning (ensure no API keys in Git)
- [ ] Frontend deployed to Vercel:
  - Auto-deploy on Git push
  - Environment variables configured
  - Custom domain (optional)
- [ ] Backend deployed to Railway:
  - Node.js app deployed
  - SurrealDB connected (Railway add-on or SurrealDB Cloud)
  - Redis connected (Railway add-on)
  - Environment variables configured
  - Health check endpoint (`/health`)
- [ ] Monitoring setup:
  - Sentry error tracking (frontend + backend)
  - Railway logs accessible
  - Anthropic API usage dashboard monitored
- [ ] Beta launch:
  - 50 couples invited (personal network, social media)
  - Feedback form created (Google Forms or Typeform)
  - Monitor usage metrics (conflicts created, completion rate)
  - Iterate on feedback (bug fixes, UX improvements)

## Technical Details

**E2E Tests** (`tests/e2e/`):
```typescript
// tests/e2e/full-workflow.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Full Conflict Workflow', () => {
  test('Partner A creates conflict, Partner B responds, both view guidance', async ({ page, context }) => {
    // Register Partner A
    await page.goto('http://localhost:3000/register');
    await page.fill('input[name="email"]', 'partnera@example.com');
    await page.fill('input[name="password"]', 'SecurePass123!');
    await page.click('button[type="submit"]');

    // Complete intake survey
    await expect(page).toHaveURL(/\/intake/);
    await page.selectOption('select[name="age_range"]', '25-34');
    await page.selectOption('select[name="communication_style"]', 'Direct');
    // ... fill remaining 15-20 questions
    await page.click('button:has-text("Submit")');

    // Invite Partner B
    await page.goto('/settings/invite');
    await page.fill('input[name="email"]', 'partnerb@example.com');
    await page.click('button:has-text("Send Invitation")');

    // Open invitation email (simulate)
    const invitationToken = await getInvitationTokenFromEmail('partnerb@example.com');

    // Partner B accepts invitation (new browser context)
    const partnerBPage = await context.newPage();
    await partnerBPage.goto(`http://localhost:3000/accept/${invitationToken}`);
    await partnerBPage.fill('input[name="password"]', 'SecurePass456!');
    await partnerBPage.click('button[type="submit"]');

    // Partner B completes intake
    // ... (similar to Partner A)

    // Partner A creates conflict
    await page.goto('/conflicts/new');
    await page.fill('input[name="title"]', 'Household chores');
    await page.fill('textarea[name="description"]', 'I feel like I do all the cleaning...');
    await page.selectOption('select[name="visibility"]', 'shared');
    await page.selectOption('select[name="guidance_mode"]', 'structured');
    await page.click('button:has-text("Submit")');

    // Wait for AI guidance (Prompt 1A)
    await page.waitForSelector('text=Your Individual Guidance', { timeout: 60000 });

    // Verify Partner A sees individual guidance
    await expect(page.locator('text=Emotions I\'m Noticing')).toBeVisible();

    // Partner B sees pending conflict
    await partnerBPage.goto('/dashboard');
    await expect(partnerBPage.locator('text=Household chores')).toBeVisible();
    await partnerBPage.click('text=Household chores');

    // Verify Partner B does NOT see Partner A's description
    await expect(partnerBPage.locator('text=I feel like I do all the cleaning')).not.toBeVisible();

    // Partner B responds
    await partnerBPage.fill('textarea[name="description"]', 'I do help, but it goes unnoticed...');
    await partnerBPage.selectOption('select[name="visibility"]', 'shared');
    await partnerBPage.click('button:has-text("Submit")');

    // Wait for AI guidance (Prompts 1B, 2A, 2B, 3)
    await partnerBPage.waitForSelector('text=Your Individual Guidance', { timeout: 60000 });

    // Verify Partner B now sees Partner A's description (if shared)
    await expect(partnerBPage.locator('text=Partner A\'s Perspective')).toBeVisible();
    await expect(partnerBPage.locator('text=I feel like I do all the cleaning')).toBeVisible();

    // Verify both partners see relationship guidance
    await expect(page.locator('text=Relationship Guidance')).toBeVisible();
    await expect(partnerBPage.locator('text=Relationship Guidance')).toBeVisible();
  });

  test('Private visibility prevents Partner B from seeing description', async ({ page, context }) => {
    // ... similar setup
    // Partner A creates conflict with visibility='private'
    await page.selectOption('select[name="visibility"]', 'private');
    await page.click('button:has-text("Submit")');

    // Partner B responds
    const partnerBPage = await context.newPage();
    await partnerBPage.goto('/conflicts/' + conflictId);
    await partnerBPage.fill('textarea[name="description"]', 'My response...');
    await partnerBPage.click('button:has-text("Submit")');

    // Verify Partner B does NOT see Partner A's description (even after submission)
    await expect(partnerBPage.locator('text=Private (not shared)')).toBeVisible();
  });
});
```

**Security Audit Checklist**:
- [ ] SQL Injection: N/A (SurrealDB uses parameterized queries)
- [ ] XSS: Verified React auto-escapes user input
- [ ] CSRF: JWT in httpOnly cookies prevents CSRF
- [ ] Authentication: JWT expiry tested, refresh token rotation works
- [ ] Authorization: Partner B cannot access Partner A's private data (API test)
- [ ] Rate Limiting: 100+ requests blocked (manual test)
- [ ] Secrets: No API keys in Git history (use `git-secrets` or GitHub secret scanning)
- [ ] Dependencies: `npm audit` shows 0 high/critical vulnerabilities
- [ ] HTTPS: Enforced by Vercel/Railway (tested)

**Deployment**:

**Vercel (Frontend)**:
```bash
# Install Vercel CLI
npm i -g vercel

# Deploy
cd frontend
vercel --prod

# Environment variables (set in Vercel dashboard)
VITE_API_URL=https://couples-therapy-api.railway.app
```

**Railway (Backend)**:
```bash
# Install Railway CLI
npm i -g @railway/cli

# Login
railway login

# Create project
railway init

# Deploy
cd backend
railway up

# Environment variables (set in Railway dashboard)
SURREALDB_URL=...
ANTHROPIC_API_KEY=...
JWT_SECRET=...
SENDGRID_API_KEY=...
FRONTEND_URL=https://couples-therapy.vercel.app
```

**SurrealDB Setup**:
- Option 1: Railway add-on (if available)
- Option 2: SurrealDB Cloud ($25-100/month)
- Option 3: Docker on Railway ($5/month, 1GB RAM)

**Redis Setup**:
- Railway Redis add-on (free tier, 25MB)

**Monitoring**:

**Sentry**:
```bash
npm install @sentry/react @sentry/node

# Frontend (React)
Sentry.init({
  dsn: 'https://...',
  environment: 'production',
  tracesSampleRate: 0.1
});

# Backend (Node.js)
Sentry.init({
  dsn: 'https://...',
  environment: 'production',
  integrations: [new Sentry.Integrations.Http({ tracing: true })]
});
```

**Anthropic API Usage**:
- Monitor daily via Anthropic dashboard (https://console.anthropic.com)
- Set budget alert at $1000/month

**Beta Launch**:
1. Create landing page explaining the app
2. Invite 50 couples (personal network, Reddit r/relationships, Facebook groups)
3. Feedback form: https://forms.gle/... (ask: ease of use, AI quality, bugs, feature requests)
4. Monitor metrics:
   - Conflict creation rate (target: 2-3 conflicts/week per couple)
   - Completion rate (target: 65% both partners respond)
   - Retention (target: 50% return within 30 days)
5. Iterate:
   - Fix bugs within 48 hours
   - UX improvements based on feedback (e.g., clearer instructions)
   - Prompt tuning if AI quality issues arise

## Dependencies

- [ ] All tasks 1-7 complete
- [ ] Vercel account
- [ ] Railway account
- [ ] SurrealDB Cloud account (or Docker setup)
- [ ] Sentry account

## Effort Estimate

- **Size**: L
- **Hours**: 40-48 hours (5-6 days)
- **Parallel**: false (depends on all other tasks)

## Definition of Done

- [ ] E2E tests pass (full workflow, privacy scenarios)
- [ ] Security audit completed, no critical issues
- [ ] Frontend deployed to Vercel (accessible via URL)
- [ ] Backend deployed to Railway (health check returns 200)
- [ ] Sentry error tracking active (tested by triggering error)
- [ ] 50 couples invited to beta
- [ ] Feedback form created and shared
- [ ] Usage metrics monitored (conflicts created, completion rate)
- [ ] At least 10 couples have completed 1+ conflicts
- [ ] Bug fixes deployed based on beta feedback
- [ ] Documentation: Deployment guide, troubleshooting, API docs
