---
name: Intake Interview (Chat-Based)
status: closed
created: 2025-12-23T20:56:49Z
updated: 2025-12-25T18:15:04Z
github: https://github.com/vadimalpha/taskmanager/issues/14
depends_on: [13, 22]
parallel: true
conflicts_with: []
---

# Task: Intake Interview (Chat-Based)

## Description

Create a chat-based intake interview where the AI conducts a conversational interview to learn about each user's background, communication style, relationship context, conflict triggers, and goals. Instead of a predefined survey form, users chat naturally with the AI which asks follow-up questions based on responses. Reuses ChatWindow/ChatMessage/ChatInput components from Chat Infrastructure task.

## Acceptance Criteria

- [ ] IntakeChat component (reuses ChatWindow/ChatMessage/ChatInput from Task #22)
- [ ] Intake interview system prompt:
  - Warm, conversational, non-clinical tone
  - Asks ONE question at a time
  - Follows up on interesting/significant responses
  - Validates and normalizes user experiences
  - Adapts conversation based on user responses
- [ ] Topics covered through natural dialogue:
  - Basic introduction (name, how they're feeling about starting)
  - Current relationship (duration, living situation, stage)
  - Communication style (how they express themselves during conflict)
  - Conflict triggers (what topics/situations cause tension)
  - Previous relationship patterns (if comfortable)
  - Relationship goals (what they hope to improve)
- [ ] AI summarizes learned information at end for user confirmation
- [ ] "I'm ready" button to finalize intake (same UX as exploration chat)
- [ ] Full transcript stored in SurrealDB with vector embeddings
- [ ] Save/resume functionality (conversation continues where left off)
- [ ] Profile management (quarterly "refresh" intake conversation)
- [ ] Backend endpoint for intake conversation messages

## Technical Details

**Frontend Components**:
- `IntakeChat.tsx` - Intake chat page (reuses ChatWindow, ChatMessage, ChatInput)
- `IntakeSummary.tsx` - Shows AI's summary for confirmation
- `ProfilePage.tsx` - View intake summary, trigger "refresh" conversation

**Backend Structure**:
- `POST /api/intake/messages` - Send message in intake conversation
- `GET /api/intake/conversation` - Get full intake transcript
- `POST /api/intake/finalize` - "I'm ready" button finalizes intake
- `PATCH /api/users/me/intake-refresh` - Trigger quarterly refresh conversation

**Conversation Session**:
- session_type: `intake`
- status: `active` or `finalized`
- Store full transcript in `conversation_sessions` table
- Extract key insights into `intake_data` field on user

**Vector Embedding Strategy**:
- Extract key quotes from user messages about triggers, patterns, goals
- Generate embeddings for semantic search during conflict exploration
- Store in SurrealDB with vector similarity search

**Data Model** (extracted from conversation):
```typescript
interface IntakeData {
  name: string;
  relationship_duration: string;
  living_situation: string;
  communication_style_summary: string;
  conflict_triggers: string[];
  previous_patterns: string;
  relationship_goals: string[];
  intake_conversation_id: string; // Reference to full transcript
  completed_at: Date;
  last_updated: Date;
  embedding?: number[]; // Vector for RAG
}
```

## Dependencies

- [ ] Task #13 complete (database schema, user service)
- [ ] Task #22 complete (Chat Infrastructure - ChatWindow, ChatMessage, ChatInput components)
- [ ] Anthropic Claude API integration (can share with exploration chat)

## Effort Estimate

- **Size**: M
- **Hours**: 32-40 hours (4-5 days)
- **Parallel**: true (can work alongside Tasks #23, #19)

## Definition of Done

- [ ] IntakeChat component works with chat infrastructure
- [ ] Intake interview system prompt produces warm, conversational interviews
- [ ] AI covers all required topics through natural dialogue (not scripted)
- [ ] AI summarizes what it learned at end of conversation
- [ ] "I'm ready" button finalizes intake
- [ ] Save/resume works (user can exit mid-conversation, return later)
- [ ] Full transcript stored in SurrealDB
- [ ] Key insights extracted and stored in user's intake_data
- [ ] Vector embeddings generated for semantic search
- [ ] Profile page shows intake summary
- [ ] Quarterly refresh functionality works
- [ ] Unit tests for intake service
- [ ] E2E test: User completes intake interview via chat
- [ ] UI is mobile-responsive
